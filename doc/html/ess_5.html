<HTML>
<HEAD>
<!-- Created by texi2html 1.56k from ess.texi on 5 August 2002 -->

<TITLE>ESS -- Emacs Speaks Statistics - Help for SAS</TITLE>
</HEAD>
<BODY>
Go to the <A HREF="ess_1.html">first</A>, <A HREF="ess_4.html">previous</A>, <A HREF="ess_6.html">next</A>, <A HREF="ess_16.html">last</A> section, <A HREF="ess_toc.html">table of contents</A>.
<P><HR><P>


<H1><A NAME="SEC25" HREF="ess_toc.html#TOC25">Help for SAS</A></H1>


<UL>
<LI><A HREF="ess_5.html#SEC26">ESS(SAS)--Design philosophy</A>
<LI><A HREF="ess_5.html#SEC27">ESS(SAS)--Editing files</A>
<LI><A HREF="ess_5.html#SEC28">iESS(SAS)--Interactive SAS processes</A>
<LI><A HREF="ess_5.html#SEC29">ESS(SAS)--Batch SAS processes</A>
<LI><A HREF="ess_5.html#SEC30">ESS(SAS)--Function keys for batch processing</A>
<LI><A HREF="ess_5.html#SEC31">ESS(SAS)--TAB key</A>
<LI><A HREF="ess_5.html#SEC32">ESS(SAS)--Usage scenarios</A>
<LI><A HREF="ess_5.html#SEC33">iESS(SAS)--Common problems</A>
<LI><A HREF="ess_5.html#SEC34">ESS(SAS)--MS Windows</A>
</UL>

<P>
ESS[SAS] was designed for use with SAS.  It is descended from emacs 
macros developed by John Sall for editing SAS programs and SAS-mode by 
Tom Cook.  Those editing features and new advanced features are part of 
ESS[SAS].  The user interface of ESS[SAS] has similarities with ESS[S]
and the SAS Display Manager.  By emacs, we mean either GNU Emacs from 
the Free Software Foundation or XEmacs from the XEmacs Project.




<H2><A NAME="SEC26" HREF="ess_toc.html#TOC26">ESS[SAS]--Design philosophy</A></H2>

<P>
ESS[SAS] was designed to aid the user in writing and maintaining
SAS programs, such as myfile.sas.  Both interactive and batch submission
of SAS programs is supported.   


<P>
ESS[SAS] was written with two primary goals.


<P>
1. Using the emacs environment is desirable for users accessing a remote
computer via a network or dial-up who can not use the SAS Display Manager.


<P>
2. Using the emacs environment is desirable for local users as well due to the
inherent efficiency of using the same, superior interface all of the time.




<H2><A NAME="SEC27" HREF="ess_toc.html#TOC27">ESS[SAS]--Editing files</A></H2>

<P>
ESS[SAS] is the mode for editing SAS language files.  This mode handles:



<PRE>
- proper indenting, generated by both [Tab] and [Return].
- color and font choices based on syntax.
- ability to send the contents of an entire buffer, a highlighted region,
  or a single line to an interactive SAS process.
- ability to switch between processes which would be the target of the
  buffer (for the above).
- ability to save and submit the file you are working on as a batch SAS
  process with a single keypress and to continue editing while it is runs
  in the background.
- capability of killing the batch SAS process through the shell buffer or
  allow the SAS process to keep on running after you exit emacs.
- single keypress navigation of .sas, .log and .lst files (.log and .lst
  files are automatically refreshed with each keypress).
</PRE>

<P>
ESS[SAS] is automatically turned on when editing a file with a ".sas" 
suffix (or other, if specified in ess-site via auto-mode-alist).  The batch 
processing keypress commands can be enabled to use the same function keys that the 
SAS Display Manager does.  The interactive capabilities of ESS require you to
start an inferior SAS process with M-x SAS
(See section <A HREF="ess_5.html#SEC28">iESS[SAS]--Interactive SAS processes</A>.)


<P>
At this writing, the indenting and syntax highlighting are generally 
correct.  Known issues:  for multiple line * or %*
comments, only the first line is highlighted; for .log files, only the first
line of a NOTE:, WARNING: or ERROR: message is highlighted; unmatched single/double
quotes in CARDS data lines are NOT ignored.




<H2><A NAME="SEC28" HREF="ess_toc.html#TOC28">iESS[SAS]--Interactive SAS processes</A></H2>

<P>
iESS (inferior ESS) is the method for interfacing with interactive
statistical processes (programs).  iESS[SAS] is what is needed for
interactive SAS programming.  iESS[SAS] works best
with the following settings for SAS command-line options 
(the default of inferior-SAS-args):



<PRE>
-stdio -linesize 80 -noovp -nosyntaxcheck
</PRE>


<PRE>
-stdio          required to make the redirection of stdio work
-linesize 80    keeps output lines from folding on standard terminals
-noovp          prevents error messages from printing 3 times
-nosyntaxcheck  permits recovery after syntax errors
</PRE>

<P>
To start up iESS[SAS] mode, use:

<PRE>
   M-x SAS
</PRE>

<P>
The *SAS:1.log* buffer in ESStr mode corresponds to the file
myfile.log in SAS batch usage and to the "SAS: LOG" window in the SAS
Display Manager.  All commands submitted to SAS, informative
messages, warnings, and errors appear here.


<P>
The *SAS:1.lst* buffer in ESSlst mode corresponds to the file
myfile.lst in SAS batch usage and to the "SAS: OUTPUT" window in the
SAS Display Manager.  All data related printed output from the
PROCs appear in this window.


<P>
The iESS [SAS:1] buffer exists solely as a communications buffer.
Files are edited in the myfile.sas buffer.  The C-c C-r key in
ESS[SAS] is the functional equivalent of bringing a file into the
"SAS: PROGRAM EDITOR" window followed by the 'Local' 'Submit' menu
commands.  The user should never use this buffer directly.


<P>
Troubleshooting: See section <A HREF="ess_5.html#SEC33">iESS[SAS]--Common problems</A>.




<H2><A NAME="SEC29" HREF="ess_toc.html#TOC29">ESS[SAS]--Batch SAS processes</A></H2>

<P>
Submission of a SAS batch job is dependent on your environment.  
ess-sas-submit-method is determined by your operating system and your shell.
It defaults to 'sh unless you are running Windows or Mac Classic.  Under Windows,
it will default to 'sh if you are using bash for your shell rather than
MS-DOS ('ms-dos).  On Mac OS X, it will default to 'sh, but under Mac Classic 
AppleScript is used ('apple-script).  You will also set this to 'sh if the SAS batch 
job needs to run on a remote machine rather than your local machine.  This works
transparently if you are editing the remote file via ange-ftp/EFS or tramp.  
However, if you are editing the file locally and transferring it back and forth
with Kermit, you need some additional steps.  First of all, start Kermit locally
before remotely logging in.  Open a local copy of the file with the 
ess-kermit-prefix character prepended (the default is "#").  Execute the command 
ess-kermit-get which brings the contents of the remote file into your local copy.  
Also, note that the remote Kermit command is defined by ess-kermit-command.  


<P>
The command used by the SUBMIT function key (F3 or F8) to submit a batch SAS 
job, whether local or remote, is ess-sas-submit-command which defaults to sas-program.  sas-program is 
"invoke SAS using program file" for Mac Classic and "sas" otherwise.  However, 
you may have to alter ess-sas-submit-command for a particular program, so it is 
defined as buffer-local (conveniently, you can set it in Local Variables: at 
the end of your program).  The command line is also made of 
ess-sas-submit-pre-command, ess-sas-submit-post-command and 
ess-sas-submit-command-options (the last of which is also buffer-local).
Here are some examples for your .emacs file (you may also use 
M-x customize-variable with):

<PRE>
(setq ess-sas-submit-pre-command "nohup")                 ;'sh default
(setq ess-sas-submit-post-command "-rsasuser &#38;")          ;'sh default
(setq ess-sas-submit-command "/usr/local/sas/sas")        ;'sh example
(setq ess-sas-submit-pre-command "start")                 ;'ms-dos default
(setq ess-sas-submit-post-command "-rsasuser -icon")      ;'ms-dos default
(setq ess-sas-submit-command "c:/progra~1/sas/sas.exe")   ;Windows example
(setq ess-sas-submit-command "c:\\progra~1\\sas\\sas.exe");Windows example
</PRE>

<P>
There is a built-in delay before a batch SAS job is submitted when using
a Unix shell under Windows.  This is necessary in many cases 
since the shell might not be ready to receive a command.  This delay is 
currently set high enough so as not to be a problem.  But,
there may be cases when it needs to be set higher, or could be set much
lower to speed things up.  You can over-ride the default in your .emacs
file by:

<PRE>
(setq ess-sleep-for 0.2)
</PRE>



<H2><A NAME="SEC30" HREF="ess_toc.html#TOC30">ESS[SAS]--Function keys for batch processing</A></H2>

<P>
The setup of function keys for SAS batch processing
is unavoidably complex, but the usage of function keys is simple.  
There are five distinct options:


<P>
Option 1 (default).  Function keys in ESS[SAS] are not bound to elisp commands.
This is in accordance with the GNU Elisp Coding Standards (GECS) which do 
not allow function keys to be bound so that they are available to the user.


<P>
Options 2-5.  Since GECS does not allow function keys to be bound by modes,
these keys are often unused.  So, ESS[SAS] provides
users with the option of binding elisp commands to these keys.  Users 
who are familiar with SAS will, most likely, want to duplicate the function
key capabilities of the SAS Display Manager.  There are four options (noted
in parentheses below).



<OL>
<LI>

SAS provides different function key definitions with its Unix (2, 4) and 
Windows (3, 5) products; ESS can use either.
<LI>

The ESS[SAS] function key definitions can be active in all buffers
(global: 4, 5) or limited (local: 2, 3) only to buffers with files that are
associated with ESS[SAS] as defined in your auto-mode-alist.
</OL>

<P>
The distinction between local and global is subtle.  If you want
the ESS[SAS] definitions to work when you are in the *shell* buffer or when
editing files other than the file extensions that ESS[SAS] recognizes, you
will most likely want to use the global definitions.
If you want your function keys to understand SAS batch commands when you
are editing SAS files, and to behave normally when editing other files,
then you will choose the local definitions.  The option can be chosen by 
the person installing ESS for a site or by an individual.



<OL>
<LI>

For a site installation or an individual, uncomment ONLY ONE of the 
following lines in your ess-site.el!
ESS[SAS] Function keys are available in ESS[SAS] if you
uncomment either 2 or 3 and in all modes if you uncomment 4 or 5:

<PRE>
;;2; (setq ess-sas-local-unix-keys t)
;;3; (setq ess-sas-local-pc-keys t)
;;4; (setq ess-sas-global-unix-keys t)
;;5; (setq ess-sas-global-pc-keys t)
</PRE>

The names -unix- and -pc- have nothing to do with the operating system
that you are running.  Rather, they mimic the definitions that the SAS
Display Manager uses by default on those platforms.

<LI>

If your site installation has configured the keys contrary to your 
liking, say 2, you must turn it off before selecting a different 
option, say 3.  

<PRE>
 (load "ess-site")
 (setq ess-sas-local-unix-keys nil) ;;2
 (setq ess-sas-local-pc-keys t)     ;;3
</PRE>

</OL>

<P>
Finally, we get to what the function keys actually do.  You may recognize
some of the Short Names as SAS Display Manager commands (they
are in all capitals).



<PRE>
Unix PC   Short Name    Long Description

F2   F2   refresh       revert the current buffer with the file of the 
                        same name if the file is newer than the buffer

F3   F8   SUBMIT        save the current .sas file (which is either the
                        .sas file in the current buffer or the .sas
                        file associated with the .lst or .log file in the
                        current buffer) and submit the file as a batch 
                        SAS job

F4   F5   PROGRAM       switch buffer to .sas file

F5   F6   LOG           switch buffer to .log file, `refresh' and goto 
                        next error message, if any

F6   F7   OUTPUT        switch buffer to .lst file and `refresh'

F7   F4   filetype-1    switch buffer to filetype-1 (defaults to .txt) 
                        file and `refresh'

F8   F3   shell         switch buffer to shell

F9   F9   VIEWTABLE     open an interactive FSEDIT/FSBROWSE session
                        on the SAS dataset near point

F10  F10  toggle-log    toggle ESS[SAS] for .log files; may be useful
                        for certain debugging situations

F11  F11  filetype-2    switch buffer to filetype-2 (defaults to .dat) 
                        file and `refresh'

F12  F12  viewgraph     open a GSASFILE near point for viewing either
                        in emacs or with an external viewer

C-F3 C-F8 submit-region    write region to ess-temp.sas and submit

C-F5 C-F6 append-to-log    append ess-temp.log to the current .log file

C-F6 C-F7 append-to-output append ess-temp.lst to the current .lst file
</PRE>

<P>
SUBMIT, PROGRAM, LOG and OUTPUT need no further explanation since
they mimic the SAS Display Manager function key definitions.  However, six 
other keys have been provided for convenience and are described below.


<P>
`shell' switches you to the *shell* buffer where you can interact with
your operating system.  This is especially helpful if you would like to 
kill a SAS batch job.  You can specify a different buffer name to 
associate with a SAS batch job (besides *shell*) with the buffer-local 
variable ess-sas-shell-buffer.  This allows you to have multiple 
buffers running SAS batch jobs on multiple local/remote computers
that may rely on different methods specified by the buffer-local variable
ess-sas-submit-method.


<P>
F2 performs the `refresh' operation on the current buffer.  `refresh' 
compares the buffer's last modified date/time with the file's last
modified date/time and replaces the buffer with the file if the file is newer.  
This is the same operation that is automatically performed when LOG, OUTPUT, 
`filetype-1' or `filetype-2' are pressed.


<P>
`filetype-1' switches you to a file with the same file name as your .sas file, 
but with a different extension (.txt by default) and performs `refresh'.  
You can over-ride the default extension; for example in your .emacs file:  

<PRE>
(setq ess-sas-suffix-1 "csv") ; for example
</PRE>

<P>
F9 will prompt you for the name of a permanent SAS dataset near point to be opened
for viewing by PROC FSEDIT.  You can control the SAS batch command-line with
ess-sas-data-view-submit-options.  For controlling the SAS batch commands, you have 
the global variables ess-sas-data-view-libname and ess-sas-data-view-fsview-command 
as well as the buffer-local variable ess-sas-data-view-fsview-statement.  If
you have your SAS LIBNAMEs defined in autoexec.sas, then the defaults for
these variables should be sufficient.


<P>
F10 toggles ESS[SAS] mode for .log files which is off by default (technically, 
it is SAS-log-mode, but it looks the same).  The syntax highlighting can be 
helpful in certain debugging situations, but large .log files may take a long 
time to highlight.  


<P>
F11 is the same as `filetype-1' except it is .dat by default.  


<P>
F12 will prompt you for the name of a GSASFILE near point to be opened for viewing either with
emacs or with an external viewer.  Depending on your version of emacs and
the operating system you are using, emacs may support .gif and .jpg files
internally.  You may need to change the following two variables for your
own situation:

<PRE>
(setq ess-sas-graph-suffix-regexp "[.]\\(e?ps\\|gif\\|jpe?g\\|tiff?\\)")
(setq ess-sas-image-viewer "kodakimg") ;; Windows external viewer
</PRE>



<H2><A NAME="SEC31" HREF="ess_toc.html#TOC31">ESS[SAS]--TAB key</A></H2>

<P>
Two options.  The TAB key is bound by default to sas-indent-line.  This function is
used to syntactically indent SAS code so PROC and RUN are in the left
margin, other statements are indented 4 spaces from the margin,
continuation lines are indented 4 spaces in from the beginning column
of that statement.  This is the type of functionality that emacs
provides in most programming language modes.  This functionality is
equivalent to uncommenting the following line in ess-site.el:

<PRE>
(setq ess-sas-edit-keys-toggle 0)
</PRE>

<P>
ESS provides an alternate behavior for the TAB key that makes it
behave as it does in other editors, i.e. move the cursor to the
next tab stop.  The alternate behavior also provides a backwards TAB,  
C-TAB, that moves the cursor to the tab stop to the left and deletes
any characters between them.  This functionality is obtained by uncommenting the
following line in ess-site.el:

<PRE>
(setq ess-sas-edit-keys-toggle 1)
</PRE>

<P>
Under the alternate behavior, the TAB key is bound to tab-to-tab-stop
and the tab stops are set at multiples of sas-indent-width.




<H2><A NAME="SEC32" HREF="ess_toc.html#TOC32">ESS[SAS]--Usage scenarios</A></H2>

<P>
We present one scenario for using ESS to interact with SAS (comments 
are prefixed by "##").


<P>
SAS Batch (ess-sas-global-unix-keys shown with
    ess-sas-global-pc-keys denoted by -pc- comments)

<PRE>
    ## Find the file you want to work with
    C-x C-f myfile.sas
    ## myfile.sas will be in ESS[SAS] mode

    ## Edit as appropriate, then save and submit the batch SAS job.
    ## -pc- F8
    F3

    ## The job runs in the shell buffer while you continue to edit 
    ## myfile.sas.  If ess-sas-submit-method is 'sh, then the 
    ## message buffer will display the shell notification when the 
    ## job is complete.  The 'sh setting also allows you to 
    ## terminate the SAS batch job before it is finished.
    ## -pc- F3
    F8

    ## Terminating a SAS batch job; typing in the *shell* buffer.
    kill %1

    ## You may want to visit the .log (whether the job is still running 
    ## or it is finished) and check for error messages.  The .log will be
    ## refreshed and you will be placed in it's buffer.  You will be 
    ## taken to the 1st error message after the cursor, if any.  
    ## -pc- F6
    F5

    ## Goto the next error message, if any.
    ## -pc- F6
    F5

    ## Now, refresh the .lst and go to it's buffer.
    ## -pc- F7
    F6

    ## If you wish to make changes, go to the .sas file with
    ## -pc- F5
    F4

    ## Make your editing changes and submit again.
    ## -pc- F8
    F3
</PRE>

<P>
Interactive SAS

<PRE>
    ## Find the file you want to work with
    C-x C-f myfile.sas
    ## myfile.sas will be in ESS[SAS] mode

    ## Edit as appropriate, and then start up SAS with the cursor in
    ## the myfile.sas buffer
    M-x SAS

    ## Four buffers will appear on screen:
    ## myfile.sas  in  ESS[SAS]        mode # your source file
    ## *SAS:1*     in  iESS [SAS:1]    mode # ESS communication buffer
    ## *SAS:1.log* in  Shell [] ESStr  mode # SAS log information
    ## *SAS:1.lst* in  Shell [] ESSlst mode # SAS listing information

    ## If you would prefer each of the four buffers to appear in its
    ## own individual frame, you can arrange for that.  Place the
    ## cursor in the buffer displaying myfile.sas.  Enter the
    ## sequence:
    C-c C-w

    ## The cursor will normally be in buffer myfile.sas.
    ## If not, put it there:
    C-x b myfile.sas

    ## Send regions, lines, or the entire file contents to SAS
    ## (regions are most useful).  A highlighted region will normally
    ## begin with the keywords 'DATA' or 'PROC' and end with the
    ## keyword 'RUN;'
    C-c C-r

    ## Information appears in the log buffer, analysis results in the
    ## listing buffer.  In case of errors, make the corrections in the
    ## myfile.sas buffer and resubmit with another C-c C-r

    ## PROC GPLOT graphs will normally be produced in a postscript
    ## file and be viewed later.  Include the lines
    /* required gsoptions for batch files */
    /* comment out these lines for interactive use on X-terminals*/
    filename grafout 'temp.ps';
    goptions device=ps gsfname=grafout gsfmode=append gaccess=sasgastd;
    ## in myfile.sas.

    ## PROC PLOT graphs can be viewed in the listing buffer.  You may
    ## wish to control the vertical spacing to allow the entire plot
    ## to be visible on screen, for example, by
    proc plot; plot a*b / vpos=25;

    ## At the end of the session you may save the log and listing
    ## buffers with the usual C-x C-s commands.  You will be prompted
    ## for a file name.  Typically, the names myfile.log and mfile.lst
    ## will be used.  You will almost certainly want to edit the saved
    ## files before including them in a report.  The files are
    ## read-only by default.  You can make them writable by the emacs
    ## command C-x C-q.

    ## At the end of the session, the input file myfile.sas will
    ## typically have been revised.  You can save it.  It can be used
    ## later as the beginning of another iESS[SAS] session.  It can
    ## also be used as a batch input file to SAS.

    ## The *SAS:1* buffer is strictly for ESS use.  The user should
    ## never need to read it or write to it.  Refer to the .lst and
    ## .log buffers for monitoring output!
</PRE>



<H2><A NAME="SEC33" HREF="ess_toc.html#TOC33">iESS[SAS]--Common problems</A></H2>


<PRE>
1. iESS[SAS] does not work on Windows.  In order to run SAS inside
   an emacs buffer, it is necessary to start SAS with the -stdio option.
   SAS does not support the -stdio option on Windows.

2. If M-x SAS gives errors upon startup, check the following:
   - you are running Windows:  see 1.
   - ess-sas-sh-command (in the ESS source directory) needs to be
     executable (solution: "chmod ugo+rx ess-sas-sh-command").
   - sas isn't in your executable path (verify using "which sas" from
     a shell command-line)

3. M-x SAS starts SAS Display Manager.  Probably, the command "sas" 
   on your system calls a shell script.  

   Change the line in ess-sas-sh-command file from:

<PRE>
sas &#60;/dev/tty 1&#62;$stdout 2&#62;$stderr $
</PRE>

   to the correct path name of the sas executable, for example:

<PRE>
/usr/local/sas612/sas &#60;/dev/tty 1&#62;$stdout 2&#62;$stderr $
</PRE>

   To find the sas exectuable, you can execute the unix command:

<PRE>
find / -name sas -print
</PRE>

   and expect a response similar to the following

<PRE>
/usr/local/sas612/sas
</PRE>

</PRE>



<H2><A NAME="SEC34" HREF="ess_toc.html#TOC34">ESS[SAS]--MS Windows</A></H2>


<UL>
<LI>

iESS[SAS] does not work on Windows.  See section <A HREF="ess_5.html#SEC33">iESS[SAS]--Common problems</A>.

<LI>

ESS[SAS] mode for editing SAS language files works very well.
See section <A HREF="ess_5.html#SEC27">ESS[SAS]--Editing files</A>.

<LI>

There are two execution options for SAS on Windows.
You can use batch.  See section <A HREF="ess_5.html#SEC29">ESS[SAS]--Batch SAS processes</A>.

Or you can mark regions with the mouse and submit the code with
`submit-region' or paste them into SAS Display Manager.

</UL>

<P><HR><P>
Go to the <A HREF="ess_1.html">first</A>, <A HREF="ess_4.html">previous</A>, <A HREF="ess_6.html">next</A>, <A HREF="ess_16.html">last</A> section, <A HREF="ess_toc.html">table of contents</A>.
</BODY>
</HTML>
